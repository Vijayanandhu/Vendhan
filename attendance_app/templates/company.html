{% extends "base.html" %}
{% block title %}{{ company_name or 'Company Details' }}{% endblock %}
{% block content %}
<div class="form-container">
    <h2 class="form-title">
        <i class="fas fa-building"></i>
        Company Details
    </h2>
    
    {% if company and company.logo %}
    <div class="current-logo-section">
        <h4>Current Logo:</h4>
        <img src="{{ url_for('static', filename='uploads/' + company.logo) }}" alt="Current Company Logo" class="current-logo-preview">
    </div>
    {% endif %}
    
    <form method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}  {# This includes the CSRF token #}
        
        <div class="form-group">
            {{ form.name.label(class="form-label") }}
            {{ form.name(class="form-control", placeholder="Enter your company name") }}
            {% for error in form.name.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
        </div>
        
        <div class="form-group">
            {{ form.address.label(class="form-label") }}
            {{ form.address(class="form-control", rows=3, placeholder="Enter company address") }}
            {% for error in form.address.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
        </div>
        
        <div class="form-group">
            {{ form.email.label(class="form-label") }}
            {{ form.email(class="form-control", placeholder="company@example.com") }}
            {% for error in form.email.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-image"></i> Company Logo
            </label>
            <div class="file-upload-wrapper">
                <input type="file" name="logo" id="logo" class="file-input" accept="image/*">
                <label for="logo" class="file-upload-label">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Choose Logo File</span>
                    <small>PNG, JPG, or GIF (max 5MB)</small>
                </label>
                <div class="file-preview" id="logoPreview"></div>
            </div>
        </div>
        
        <div class="form-group">
            {{ form.phone.label(class="form-label") }}
            {{ form.phone(class="form-control", placeholder="+1 (555) 123-4567") }}
            {% for error in form.phone.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
        </div>
        
        <div class="form-group">
            {{ form.website.label(class="form-label") }}
            {{ form.website(class="form-control", placeholder="https://www.company.com") }}
            {% for error in form.website.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
        </div>
        
        <div class="button-group">
            <button type="submit" class="btn-primary">
                <i class="fas fa-save"></i> Save Company Details
            </button>
            <a href="{{ url_for('dashboard') }}" class="btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </form>
</div>

<script>
// Logo preview functionality
document.getElementById('logo').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('logoPreview');
    const label = document.querySelector('.file-upload-label span');
    
    if (file) {
        // Validate file size (5MB limit)
        if (file.size > 5 * 1024 * 1024) {
            alert('File size must be less than 5MB');
            this.value = '';
            return;
        }
        
        // Show file name
        label.textContent = file.name;
        
        // Create preview
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.innerHTML = `
                <div class="logo-preview">
                    <img src="${e.target.result}" alt="Logo Preview">
                    <p>Preview</p>
                </div>
            `;
        };
        reader.readAsDataURL(file);
    } else {
        label.textContent = 'Choose Logo File';
        preview.innerHTML = '';
    }
});
</script>
{% endblock %}
